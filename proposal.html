<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Refi Proposal - Multi-Scenario</title>
  <meta name="viewport" content="width=900, initial-scale=1">
  <style>
    body {
      font-family: Aptos, Arial, sans-serif;
      background: #f3f3f3;
      color: var(--mainFontColor, #444);
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 6px 38px #0001;
      padding: 32px 36px 44px 36px;
    }
    .header-true {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 48px;
      margin-bottom: 28px;
    }
    .logo-true img {
      height: 120px;
      width: auto;
      display: block;
      border-radius: 18px;
      background: #fff;
      border: none;
    }
    .lo-true {
      display: flex;
      align-items: center;
      gap: 18px;
    }
    .lo-photo-true {
      height: 120px;
      width: 120px;
      object-fit: cover;
      border-radius: 50%;
      border: 3px solid #eee;
      box-shadow: 0 1px 8px #0001;
      background: #fff;
    }
    .lo-details-true {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 1.5px;
    }
    .lo-report-by {
      font-size: 0.86em;
      color: #888;
      font-weight: 400;
      letter-spacing: 0.09em;
      margin-bottom: 2px;
    }
    .lo-fullname-true {
      color: var(--brandFontColor, #7CC242);
      font-size: 1.55em;
      font-weight: bold;
      margin-bottom: 2px;
    }
    .lo-company-true {
      font-size: 1.07em;
      font-weight: bold;
      color: #222;
      margin-bottom: 2px;
    }
    .lo-address-true, .lo-email-true, .lo-phone-true {
      font-size: 0.97em;
      color: #444;
    }
    .lo-numbers-true {
      font-size: 0.97em;
      color: #666;
      margin-top: 2px;
    }
    .greeting {
      font-size: 1.2em;
      color: var(--brandFontColor, #7CC242);
      margin-top: 24px;
      margin-bottom: 8px;
      font-weight: bold;
      letter-spacing: 0.01em;
    }
    .description {
      font-size: 1.05em;
      margin-bottom: 16px;
      color: #555;
    }
    .section-title {
      margin-top: 28px;
      margin-bottom: 8px;
      font-size: 1.22em;
      color: var(--brandFontColor, #7CC242);
      font-weight: bold;
      letter-spacing: 0.01em;
      border-left: 7px solid var(--brandFontColor, #7CC242);
      padding-left: 9px;
    }
    table.proposal-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-bottom: 26px;
      background: #fff;
      font-size: 1.07em;
      box-shadow: 0 1px 7px #0001;
      border-radius: 14px;
      overflow: hidden;
    }
    table.proposal-table th, table.proposal-table td {
      padding: 10px 12px;
      text-align: left;
      border: none;
      transition: background 0.1s;
    }
    table.proposal-table th {
      background: var(--mainCellColor, #4C514F);
      color: #fff;
      font-size: 1.12em;
      font-weight: bold;
      border-bottom: 1.5px solid #d8d8d8;
      letter-spacing: 0.02em;
    }
    table.proposal-table td {
      background: var(--cellBackground, #f3f3f3);
      color: var(--mainFontColor, #4E5351);
      font-size: 1.04em;
      font-weight: 500;
    }
    table.proposal-table tr.highlight td {
      background: var(--cellSecondColor, #7CC242) !important;
      color: #fff !important;
      font-weight: bold;
    }
    table.proposal-table tr.section-divider td {
      background: #fff;
      border-top: 2.5px solid #eee;
      height: 12px;
      padding: 0;
    }
    @media (max-width: 1000px) {
      .container { max-width: 100vw; padding: 9px; }
    }
  </style>
</head>
<body>
<div class="container" id="main-container" style="display:none;">
  <div class="header-true">
    <div class="logo-true">
      <img id="brandLogo" src="" alt="Logo">
    </div>
    <div class="lo-true">
      <img id="loPhoto" class="lo-photo-true" src="" alt="LO Photo">
      <div class="lo-details-true">
        <div class="lo-report-by">THE REPORT WAS CREATED FOR YOU BY</div>
        <div class="lo-fullname-true" id="loFullName"></div>
        <div class="lo-company-true" id="brandCompanyName"></div>
        <div class="lo-address-true" id="loAddress"></div>
        <div class="lo-email-true" id="loEmail"></div>
        <div class="lo-phone-true" id="loPhone"></div>
        <div class="lo-numbers-true">
          <span id="nmls"></span> | DRE: <span id="dre"></span>
        </div>
      </div>
    </div>
  </div>
  <div class="greeting" id="greeting"></div>
  <div class="description">Welcome to your personal rate & closing cost worksheet. Here you can compare your different loan, rate, and closing cost options. I am here to help you in any way to make the best decision for your goals. Please don't hesitate to contact me with questions.</div>
  <div id="proposal-tables"></div>
</div>
<script>
const sectionMap = [
  {
    title: "Loan Info",
    fields: [
      "Program", "Appraised Value", "Loan Amount", "Equity", "Loan-To-Value"
    ]
  },
  {
    title: "Rate & Term",
    fields: [
      "Rate", "APR", "Term", "Points", "Discount Point"
    ]
  },
  {
    title: "Monthly Payment",
    fields: [
      "PI", "Hazard Insurance", "Mortgage Insurance", "HOA", "Property Taxes", "Extra Monthly Payment", "Total Monthly Payment"
    ]
  },
  {
    title: "Closing Costs",
    fields: [
      "Closing Costs", "Lender Fees", "3Rd Party Fees", "Escrows & Prepaid Interest", "Cash to Close", "Closing Costs Included in Loan", "Pre-Paids and Impounds in Loan"
    ]
  },
  {
    title: "Final Calculations",
    fields: [
      "Payment Savings", "Power Refi Savings", "Interest Saved in 5 Years", "Interest Saved over Life of Loan"
    ]
  }
];

function fillStaticFields(json) {
  // Цвета
  for (const k of [
    "mainCellColor", "cellBackground", "cellSecondColor", "brandFontColor", "mainFontColor"
  ]) {
    if (json[k]) document.documentElement.style.setProperty('--'+k, json[k]);
  }
  // Лого и LO
  document.getElementById('brandLogo').src = json.logoUrl || '';
  document.getElementById('loPhoto').src = json.loPhotoUrl || '';
  document.getElementById('loFullName').textContent = json.loFullName || '';
  document.getElementById('brandCompanyName').textContent = json.brandCompanyName || '';
  document.getElementById('loAddress').textContent = json.loAddress || '';
  document.getElementById('loEmail').textContent = json.loEmail || '';
  document.getElementById('loPhone').textContent = json.loPhone || '';
  document.getElementById('nmls').textContent = json.nmls || '';
  document.getElementById('dre').textContent = json.dre || '';
  document.getElementById('greeting').textContent = json.greeting || '';
}

function getNumScenarios(json) {
  let count = 0;
  for (let i = 1; i <= 3; i++) {
    if (json[`Scenario ${i} Name`] || json[`Program ${i}`]) count = i;
  }
  return count || 1;
}

function renderProposalTables(json) {
  const numScenarios = getNumScenarios(json);
  const scenarioNames = [];
  for (let i = 1; i <= numScenarios; i++) {
    scenarioNames.push(json[`Scenario ${i} Name`] || `Option ${i}`);
  }
  const tablesDiv = document.getElementById('proposal-tables');
  tablesDiv.innerHTML = "";
  sectionMap.forEach((section, idx) => {
    const table = document.createElement('table');
    table.className = "proposal-table";
    let thead = `<thead><tr><th></th>`;
    scenarioNames.forEach(n => {
      thead += `<th>${n}</th>`;
    });
    thead += `</tr></thead>`;
    let tbody = `<tbody>`;
    section.fields.forEach(fld => {
      let isHighlight = (fld === "Total Monthly Payment" || fld === "Cash to Close" || fld === "Power Refi Savings" || fld === "Payment Savings" || fld === "Interest Saved over Life of Loan" || fld === "Interest Saved in 5 Years");
      tbody += `<tr${isHighlight ? ' class="highlight"' : ''}><td>${fld}</td>`;
      for (let i = 1; i <= numScenarios; i++) {
        let val = json[`${fld} ${i}`];
        tbody += `<td>${val !== undefined ? val : ""}</td>`;
      }
      tbody += `</tr>`;
    });
    tbody += `</tbody>`;
    tablesDiv.innerHTML += `<div class="section-title">${section.title}</div>` + table.outerHTML.replace("</table>", thead + tbody + "</table>");
  });
}

(function main() {
  // Получить id из query
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id') || 'test';
  fetch(`https://marketing2025.blob.core.windows.net/proposals/${id}.json`)
    .then(r => {
      if (!r.ok) throw new Error("Not found");
      return r.json();
    })
    .then(json => {
      document.getElementById('main-container').style.display = '';
      fillStaticFields(json);
      renderProposalTables(json);
    })
    .catch(e => {
      document.body.innerHTML = '<div style="text-align:center;color:#b22;margin-top:70px;font-size:1.3em">Proposal not found or unavailable.</div>';
    });
})();
</script>
</body>
</html>
